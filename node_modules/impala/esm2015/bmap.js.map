{"version":3,"file":"bmap.js","sources":["../../packages/impala/bmap/bmap-config.js","../../packages/impala/bmap/bmap.directive.js","../../packages/impala/bmap/bmap.module.js","../../packages/impala/bmap/overlay/generic-marker.js","../../packages/impala/bmap/overlay/portal-host-overlay.js","../../packages/impala/bmap/util/wgs84tobd09.js","../../packages/impala/bmap/index.js"],"sourcesContent":["import { InjectionToken } from '@angular/core';\nexport let /** @type {?} */ BMAP_CONFIG = new InjectionToken('bmap.config');\n//# sourceMappingURL=bmap-config.js.map","import { BMAP_CONFIG } from './bmap-config';\nimport { Directive, Input, ElementRef, NgZone, Output, EventEmitter, Inject } from '@angular/core';\nexport class BMapDirective {\n    /**\n     * @param {?} mapConfig\n     * @param {?} elementRef\n     * @param {?} zone\n     */\n    constructor(mapConfig, elementRef, zone) {\n        this.mapConfig = mapConfig;\n        this.elementRef = elementRef;\n        this.zone = zone;\n        this.mapLoaded = new EventEmitter();\n    }\n    /**\n     * @return {?}\n     */\n    ngAfterViewInit() {\n        // this.loader.load().then(() => {\n        const /** @type {?} */ map = this.map = this.zone.runOutsideAngular(() => {\n            return new BMap.Map(this.elementRef.nativeElement, {\n                enableMapClick: false\n            });\n        });\n        const /** @type {?} */ center = this.mapConfig.center || [120, 30], /** @type {?} */ zoom = this.mapConfig.zoom || 10;\n        if (2 !== center.length) {\n            throw new Error(\"invalid lon lat\");\n        }\n        map.centerAndZoom(new BMap.Point(center[0], center[1]), zoom);\n        this.mapLoaded.emit(map);\n        // });\n    }\n    /**\n     * @param {?} changes\n     * @return {?}\n     */\n    ngOnChanges(changes) {\n        if (this.map) {\n            if (changes['mapZoom']) {\n                this.map.setZoom(this.mapZoom);\n            }\n            if (changes['mapCenter']) {\n                this.map.setCenter(this.mapCenter);\n            }\n        }\n    }\n}\nBMapDirective.decorators = [\n    { type: Directive, args: [{\n                selector: '[bmap]',\n            },] },\n];\n/**\n * @nocollapse\n */\nBMapDirective.ctorParameters = () => [\n    { type: undefined, decorators: [{ type: Inject, args: [BMAP_CONFIG,] },] },\n    { type: ElementRef, },\n    { type: NgZone, },\n];\nBMapDirective.propDecorators = {\n    'mapLoaded': [{ type: Output },],\n    'mapCenter': [{ type: Input },],\n    'mapZoom': [{ type: Input },],\n};\nfunction BMapDirective_tsickle_Closure_declarations() {\n    /** @type {?} */\n    BMapDirective.decorators;\n    /**\n     * @nocollapse\n     * @type {?}\n     */\n    BMapDirective.ctorParameters;\n    /** @type {?} */\n    BMapDirective.propDecorators;\n    /** @type {?} */\n    BMapDirective.prototype.mapLoaded;\n    /** @type {?} */\n    BMapDirective.prototype.mapCenter;\n    /** @type {?} */\n    BMapDirective.prototype.mapZoom;\n    /** @type {?} */\n    BMapDirective.prototype.map;\n    /** @type {?} */\n    BMapDirective.prototype.mapConfig;\n    /** @type {?} */\n    BMapDirective.prototype.elementRef;\n    /** @type {?} */\n    BMapDirective.prototype.zone;\n}\n//# sourceMappingURL=bmap.directive.js.map","import { BMAP_CONFIG } from './bmap-config';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { BMapDirective } from './bmap.directive';\nexport class BMapModule {\n    /**\n     * @param {?} config\n     * @return {?}\n     */\n    static forRoot(config) {\n        return {\n            ngModule: BMapModule,\n            providers: [\n                { provide: BMAP_CONFIG, useValue: config }\n            ]\n        };\n    }\n}\nBMapModule.decorators = [\n    { type: NgModule, args: [{\n                declarations: [BMapDirective],\n                imports: [CommonModule],\n                exports: [BMapDirective],\n                providers: [],\n            },] },\n];\n/**\n * @nocollapse\n */\nBMapModule.ctorParameters = () => [];\nfunction BMapModule_tsickle_Closure_declarations() {\n    /** @type {?} */\n    BMapModule.decorators;\n    /**\n     * @nocollapse\n     * @type {?}\n     */\n    BMapModule.ctorParameters;\n}\n//# sourceMappingURL=bmap.module.js.map","export class GenericMarker extends BMap.Marker {\n    /**\n     * @param {?} point\n     * @param {?} opts\n     * @param {?} data\n     */\n    constructor(point, opts, data) {\n        super(point, opts);\n        this.data = data;\n    }\n}\nfunction GenericMarker_tsickle_Closure_declarations() {\n    /** @type {?} */\n    GenericMarker.prototype.data;\n}\n//# sourceMappingURL=generic-marker.js.map","import { DomPortalHost } from '@angular/cdk/portal';\n/**\n *\n */\nexport class PortalHostOverlay extends BMap.Overlay {\n    /**\n     * @param {?} componentFactoryResolver\n     * @param {?} appRef\n     * @param {?} defaultInjector\n     */\n    constructor(componentFactoryResolver, appRef, defaultInjector) {\n        super();\n        this.hostDomElement = document.createElement(\"div\");\n        this.hostDomElement.style.position = \"absolute\";\n        this.portalHost = new DomPortalHost(this.hostDomElement, componentFactoryResolver, appRef, defaultInjector);\n    }\n    /**\n     * @param {?} portal\n     * @param {?} lon\n     * @param {?} lat\n     * @return {?}\n     */\n    attach(portal, lon, lat) {\n        this.portalHost.attach(portal);\n        // [lon, lat] = wgs84tobd09(lon, lat);\n        this.point = new BMap.Point(lon, lat);\n        this.draw();\n    }\n    /**\n     * @return {?}\n     */\n    detach() {\n        this.portalHost.detach();\n    }\n    /**\n     * @param {?} map\n     * @return {?}\n     */\n    initialize(map) {\n        this.map = map;\n        let /** @type {?} */ panes = map.getPanes();\n        let /** @type {?} */ floatPane = panes.floatPane;\n        if (floatPane) {\n            floatPane.appendChild(this.hostDomElement);\n        }\n        return this.hostDomElement;\n    }\n    /**\n     * @return {?}\n     */\n    isVisible() {\n        return true;\n    }\n    /**\n     * @return {?}\n     */\n    draw() {\n        // console.log('PortalHostOverlay::draw()');\n        if (!this.point) {\n            return;\n        }\n        const /** @type {?} */ position = this.map.pointToOverlayPixel(this.point);\n        this.hostDomElement.style.left = position.x /*- this._size / 2 */ + \"px\";\n        this.hostDomElement.style.top = position.y /*- this._size / 2 */ + \"px\";\n    }\n    /**\n     * @return {?}\n     */\n    show() {\n        this.hostDomElement.style.display = \"\";\n    }\n    /**\n     * @return {?}\n     */\n    hide() {\n        this.hostDomElement.style.display = \"none\";\n    }\n}\nfunction PortalHostOverlay_tsickle_Closure_declarations() {\n    /** @type {?} */\n    PortalHostOverlay.prototype.map;\n    /** @type {?} */\n    PortalHostOverlay.prototype.point;\n    /** @type {?} */\n    PortalHostOverlay.prototype.hostDomElement;\n    /** @type {?} */\n    PortalHostOverlay.prototype.portalHost;\n}\n//# sourceMappingURL=portal-host-overlay.js.map","/**\n * 经纬度坐标转百度地图坐标\n * @param {?} lon\n * @param {?} lat\n * @return {?}\n */\nexport function wgs84tobd09(lon, lat) {\n    //     [lon, lat] = (<any>coordtransform).wgs84togcj02(lon, lat);\n    //     [lon, lat] = (<any>coordtransform).gcj02tobd09(lon, lat);\n    return [lon, lat];\n}\n//# sourceMappingURL=wgs84tobd09.js.map","/**\n * Generated bundle index. Do not edit.\n */\nexport { BMapDirective, BMapModule, BMAP_CONFIG, GenericMarker, PortalHostOverlay, wgs84tobd09 } from './public-api';\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}